<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Account Management</title>
    <style>
      :root {
        --bg: #0b1224;
        --panel: #0f172a;
        --accent: #38bdf8;
        --text: #e2e8f0;
        --muted: #94a3b8;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --radius: 14px;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: radial-gradient(circle at 20% 20%, rgba(56, 189, 248, 0.12), transparent 30%),
          radial-gradient(circle at 80% 10%, rgba(99, 102, 241, 0.12), transparent 32%),
          linear-gradient(135deg, #0b1224, #0b162e 45%, #0b1224);
        color: var(--text);
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1.25rem 1.75rem;
        background: rgba(15, 23, 42, 0.72);
        backdrop-filter: blur(14px);
        position: sticky;
        top: 0;
        z-index: 10;
        border-bottom: 1px solid rgba(148, 163, 184, 0.2);
      }
      header h1 {
        margin: 0;
        font-size: 1.5rem;
        letter-spacing: 0.01em;
      }
      header .nav-actions {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      a.button, button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.4rem;
        padding: 0.68rem 1rem;
        border-radius: 10px;
        border: 1px solid rgba(56, 189, 248, 0.4);
        background: linear-gradient(135deg, #0ea5e9, #38bdf8);
        color: #0b1224;
        font-weight: 700;
        cursor: pointer;
        text-decoration: none;
        transition: transform 120ms ease-in-out, box-shadow 120ms ease-in-out, filter 120ms;
        box-shadow: 0 12px 30px rgba(56, 189, 248, 0.25);
      }
      a.button.secondary, button.secondary {
        background: rgba(148, 163, 184, 0.08);
        color: var(--text);
        border-color: rgba(148, 163, 184, 0.35);
        box-shadow: none;
      }
      button:hover, a.button:hover {
        transform: translateY(-1px);
        filter: brightness(1.05);
      }
      main {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 1.5rem 2.5rem;
      }
      .hero {
        background: linear-gradient(135deg, rgba(14, 165, 233, 0.15), rgba(56, 189, 248, 0.08)),
          rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(56, 189, 248, 0.2);
        border-radius: var(--radius);
        padding: 1.5rem;
        box-shadow: 0 16px 38px rgba(15, 23, 42, 0.3);
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 1rem;
        align-items: center;
      }
      .hero p {
        margin: 0.25rem 0 0;
        color: var(--muted);
      }
      .grid {
        margin-top: 1.5rem;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 1rem;
      }
      .panel {
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: var(--radius);
        padding: 1.2rem 1.4rem;
        box-shadow: 0 14px 34px rgba(0, 0, 0, 0.25);
      }
      .panel h2 {
        margin: 0 0 0.35rem;
        font-size: 1.2rem;
      }
      .panel p {
        margin: 0 0 1rem;
        color: var(--muted);
      }
      label {
        display: block;
        color: var(--muted);
        font-size: 0.95rem;
        margin-bottom: 0.35rem;
      }
      input, select {
        width: 100%;
        padding: 0.7rem 0.85rem;
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(15, 23, 42, 0.7);
        color: var(--text);
        margin-bottom: 0.85rem;
        font-size: 1rem;
        transition: border-color 120ms ease-in-out, box-shadow 120ms ease-in-out;
      }
      input:focus, select:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.2);
      }
      .split {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 0.8rem;
      }
      .info-chip {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        background: rgba(56, 189, 248, 0.12);
        border: 1px solid rgba(56, 189, 248, 0.35);
        color: #e0f2fe;
        padding: 0.5rem 0.65rem;
        border-radius: 999px;
        font-weight: 600;
        margin-top: 0.35rem;
      }
      .table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 0.75rem;
      }
      .table thead {
        color: var(--muted);
        font-size: 0.95rem;
      }
      .table th, .table td {
        padding: 0.65rem 0.5rem;
        text-align: left;
        border-bottom: 1px solid rgba(148, 163, 184, 0.12);
      }
      .badge {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.35rem 0.6rem;
        border-radius: 999px;
        font-size: 0.9rem;
        font-weight: 700;
      }
      .badge.success {
        background: rgba(16, 185, 129, 0.12);
        color: #a7f3d0;
        border: 1px solid rgba(16, 185, 129, 0.3);
      }
      .badge.danger {
        background: rgba(239, 68, 68, 0.12);
        color: #fecdd3;
        border: 1px solid rgba(239, 68, 68, 0.3);
      }
      .badge.neutral {
        background: rgba(148, 163, 184, 0.12);
        color: #cbd5e1;
        border: 1px solid rgba(148, 163, 184, 0.3);
      }
      .tag-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem;
        margin: 0.5rem 0 0.25rem;
      }
      .tag {
        padding: 0.35rem 0.55rem;
        background: rgba(148, 163, 184, 0.12);
        color: #e2e8f0;
        border: 1px solid rgba(148, 163, 184, 0.25);
        border-radius: 8px;
        font-size: 0.85rem;
      }
      .actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: 0.65rem;
      }
      .actions button {
        flex: 1 1 auto;
        min-width: 140px;
      }
      .muted {
        color: var(--muted);
        font-size: 0.95rem;
      }
      .message {
        margin: 0.65rem 0 0;
        padding: 0.8rem 1rem;
        border-radius: 12px;
        font-weight: 700;
      }
      .message.success {
        background: rgba(16, 185, 129, 0.12);
        border: 1px solid rgba(16, 185, 129, 0.35);
        color: #bbf7d0;
      }
      .message.error {
        background: rgba(239, 68, 68, 0.12);
        border: 1px solid rgba(239, 68, 68, 0.35);
        color: #fecdd3;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Account Management</h1>
      <div class="nav-actions">
        <span class="info-chip">Initial password is <strong>administration</strong> for new accounts</span>
        <a class="button secondary" href="./index.html">Back to home</a>
      </div>
    </header>

    <main>
      <section class="hero">
        <div>
          <h2>Manage login access</h2>
          <p>Provision, reset, and retire user accounts for the Platform console.</p>
          <p class="muted">Default onboarding password is <strong>administration</strong>. Prompt users to update it at first sign-in.</p>
        </div>
        <div class="actions" style="max-width: 320px;">
          <button type="button">Add account</button>
          <button class="secondary" type="button">Export directory</button>
        </div>
      </section>

      <div class="grid">
      <div class="panel">
        <h2>Create or import account</h2>
        <p>Set user details and roles. A temporary password will be <strong>administration</strong>.</p>
          <form id="admin-account-form">
            <label for="full-name">Full name</label>
            <input id="full-name" name="full-name" type="text" placeholder="Maria Chen" required />

            <label for="email">Work email</label>
            <input id="email" name="email" type="email" placeholder="maria@example.com" required />

            <div class="split">
              <div>
                <label for="role">Role</label>
                <select id="role" name="role">
                  <option>Administrator</option>
                  <option selected>Workspace Manager</option>
                  <option>Analyst</option>
                  <option>Read only</option>
                </select>
              </div>
              <div>
                <label for="expiration">Access expiration</label>
                <input id="expiration" name="expiration" type="date" />
              </div>
            </div>

            <label for="notes">Notes</label>
            <input id="notes" name="notes" type="text" placeholder="Reason or ticket reference" />

            <div class="info-chip">Initial password: administration</div>
            <div class="actions">
              <button type="submit">Create account</button>
              <button class="secondary" type="button">Send welcome email</button>
            </div>
            <div class="message" id="admin-message" role="status" aria-live="polite"></div>
          </form>
        </div>

        <div class="panel">
          <h2>Directory settings</h2>
          <p>Default login policy for new users.</p>
          <div class="tag-row">
            <span class="tag">Password: administration</span>
            <span class="tag">MFA required</span>
            <span class="tag">90 day rotation</span>
          </div>
          <label for="onboarding-password">Initial password for new accounts</label>
          <input id="onboarding-password" name="onboarding-password" type="text" value="administration" />
          <div class="split">
            <div>
              <label for="lockout">Max failed attempts</label>
              <input id="lockout" name="lockout" type="number" value="5" />
            </div>
            <div>
              <label for="session-length">Session length (hours)</label>
              <input id="session-length" name="session-length" type="number" value="8" />
            </div>
          </div>
          <div class="actions">
            <button type="button">Update policy</button>
            <button class="secondary" type="button">Reset to defaults</button>
          </div>
        </div>

        <div class="panel">
          <h2>Change or reset password</h2>
          <p>Update a user's password when they cannot sign in.</p>
          <form id="password-change-form">
            <label for="password-email">Work email</label>
            <input id="password-email" name="password-email" type="email" placeholder="user@example.com" required />

            <label for="new-password">New password</label>
            <input id="new-password" name="new-password" type="password" placeholder="Enter a temporary password" required />

            <label for="confirm-password">Confirm password</label>
            <input id="confirm-password" name="confirm-password" type="password" placeholder="Repeat the password" required />

            <div class="actions">
              <button type="submit">Save password</button>
              <button class="secondary" type="button" id="reset-default-password">Set to default</button>
            </div>
            <div class="message" id="password-message" role="status" aria-live="polite"></div>
          </form>
        </div>
      </div>

      <div class="panel" style="margin-top: 1rem;">
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; flex-wrap: wrap;">
          <div>
            <h2>Login directory</h2>
            <p class="muted">Review account status, reset credentials, or disable access.</p>
          </div>
          <div class="split" style="max-width: 460px;">
            <input type="search" placeholder="Search by name or email" />
            <select>
              <option>All roles</option>
              <option>Administrator</option>
              <option>Workspace Manager</option>
              <option>Analyst</option>
              <option>Read only</option>
            </select>
          </div>
        </div>

        <table class="table">
          <thead>
            <tr>
              <th>User</th>
              <th>Role</th>
              <th>Status</th>
              <th>Last login</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="directory-body"></tbody>
        </table>
      </div>
    </main>
    <script>
      (() => {
        const STORAGE_KEY = "platformAccounts";
        const SEED_ACCOUNTS = [
          { id: "seed-1", name: "Patricia Ortega", email: "patricia@acme.io", role: "Administrator", status: "Active", lastLogin: "2 hours ago", initialPassword: "administration" },
          { id: "seed-2", name: "Devon King", email: "devon.king@acme.io", role: "Workspace Manager", status: "Password reset pending", lastLogin: "Yesterday", initialPassword: "administration" },
          { id: "seed-3", name: "Helena Rossi", email: "helena.rossi@acme.io", role: "Analyst", status: "Active", lastLogin: "Aug 12", initialPassword: "administration" }
        ];

        const directoryBody = document.getElementById("directory-body");
        const adminForm = document.getElementById("admin-account-form");
        const adminMessage = document.getElementById("admin-message");
        const addAccountButton = document.querySelector('button[type="button"]');
        const onboardingPasswordInput = document.getElementById("onboarding-password");
        const passwordChangeForm = document.getElementById("password-change-form");
        const passwordMessage = document.getElementById("password-message");

        function loadAccounts() {
          try {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) return JSON.parse(stored);
          } catch (error) {
            console.error("Failed to read stored accounts", error);
          }
          const seeded = SEED_ACCOUNTS.map((account) => ({ ...account, password: account.initialPassword || "administration" }));
          localStorage.setItem(STORAGE_KEY, JSON.stringify(seeded));
          return [...seeded];
        }

        function saveAccounts(list) {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
        }

        function getAccounts() {
          const accounts = loadAccounts();
          const normalized = accounts.map((account) => ({
            ...account,
            password: account.password || account.initialPassword || "administration"
          }));
          saveAccounts(normalized);
          return normalized;
        }

        function getOnboardingPassword() {
          return (onboardingPasswordInput?.value || "administration").trim() || "administration";
        }

        function showAdminMessage(text, type) {
          if (!adminMessage) return;
          adminMessage.textContent = text;
          adminMessage.className = `message ${type}`;
        }

        function showPasswordMessage(text, type) {
          if (!passwordMessage) return;
          passwordMessage.textContent = text;
          passwordMessage.className = `message ${type}`;
        }

        function renderDirectory() {
          if (!directoryBody) return;
          const accounts = getAccounts();
          directoryBody.innerHTML = "";

          accounts.forEach((account) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>
                <div><strong>${account.name}</strong></div>
                <div class="muted">${account.email}</div>
              </td>
              <td><span class="badge ${account.role === "Administrator" ? "success" : "neutral"}">${account.role}</span></td>
              <td><span class="badge ${account.status.toLowerCase().includes("pending") ? "danger" : "success"}">${account.status}</span></td>
              <td>${account.lastLogin}</td>
              <td><button class="secondary" type="button">Reset to ${account.initialPassword || "administration"}</button></td>
            `;
            directoryBody.appendChild(row);
          });
        }

        function addAccount({ name, email, role, status, lastLogin }) {
          const accounts = getAccounts();
          const emailExists = accounts.some((acct) => acct.email.toLowerCase() === email.toLowerCase());
          if (emailExists) {
            showAdminMessage("このメールは既に登録されています。", "error");
            return false;
          }
          const initialPassword = getOnboardingPassword();
          accounts.push({
            id: crypto.randomUUID ? crypto.randomUUID() : `acct-${Date.now()}`,
            name,
            email,
            role,
            status,
            lastLogin,
            initialPassword,
            password: initialPassword
          });
          saveAccounts(accounts);
          return true;
        }

        function findAccount(email) {
          const accounts = getAccounts();
          return { account: accounts.find((acct) => acct.email.toLowerCase() === email.toLowerCase()), accounts };
        }

        adminForm?.addEventListener("submit", (event) => {
          event.preventDefault();
          const name = document.getElementById("full-name").value.trim();
          const email = document.getElementById("email").value.trim();
          const role = document.getElementById("role").value;

          if (!name || !email) {
            showAdminMessage("名前とメールアドレスを入力してください。", "error");
            return;
          }

          const added = addAccount({
            name,
            email,
            role,
            status: "Pending first login",
            lastLogin: "Not yet"
          });

          if (added) {
            showAdminMessage("アカウントを追加しました。", "success");
            renderDirectory();
            adminForm.reset();
          }
        });

        addAccountButton?.addEventListener("click", () => {
          adminForm?.scrollIntoView({ behavior: "smooth" });
          document.getElementById("full-name")?.focus();
        });

        passwordChangeForm?.addEventListener("submit", (event) => {
          event.preventDefault();
          const email = document.getElementById("password-email").value.trim();
          const newPassword = document.getElementById("new-password").value;
          const confirmPassword = document.getElementById("confirm-password").value;

          if (!email) {
            showPasswordMessage("メールアドレスを入力してください。", "error");
            return;
          }

          if (newPassword !== confirmPassword) {
            showPasswordMessage("新しいパスワードが一致しません。", "error");
            return;
          }

          const { account, accounts } = findAccount(email);
          if (!account) {
            showPasswordMessage("該当するユーザーが見つかりません。", "error");
            return;
          }

          account.password = newPassword;
          account.initialPassword = newPassword;
          account.status = "Password updated";
          saveAccounts(accounts);
          showPasswordMessage("パスワードを更新しました。ユーザーに新しいパスワードをお知らせください。", "success");
          renderDirectory();
          passwordChangeForm.reset();
        });

        document.getElementById("reset-default-password")?.addEventListener("click", () => {
          const email = document.getElementById("password-email").value.trim();
          const { account, accounts } = findAccount(email);
          if (!email) {
            showPasswordMessage("メールアドレスを入力してください。", "error");
            return;
          }
          if (!account) {
            showPasswordMessage("該当するユーザーが見つかりません。", "error");
            return;
          }
          const defaultPassword = getOnboardingPassword();
          account.password = defaultPassword;
          account.initialPassword = defaultPassword;
          account.status = "Password reset pending";
          saveAccounts(accounts);
          showPasswordMessage(`初期パスワード（${defaultPassword}）にリセットしました。`, "success");
          renderDirectory();
        });

        renderDirectory();
      })();
    </script>
  </body>
</html>
